---
import Main from '../layouts/Main.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Main title="Contact | ThingsDoneImmediately">
  <Header />
  
  <main class="min-h-screen">
    <!-- Contact Hero -->
    <section class="pt-20 pb-12 md:pt-28 md:pb-16 px-6">
      <div class="container mx-auto max-w-6xl">
        <div class="text-center mb-8 md:mb-12">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-4 md:mb-6">
            <span class="block">Let's Build</span>
            <span class="block text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-emerald-500 mt-2">
              Something Great
            </span>
          </h1>
          <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto px-4">
            Fill this form once. Choose how you'd like to connect.
          </p>
        </div>
      </div>
    </section>

    <!-- Contact Form -->
    <section class="py-8 md:py-16 px-4 md:px-6">
      <div class="container mx-auto max-w-4xl">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10">
          
          <!-- Netlify Form + WhatsApp Choice -->
          <form 
            id="contactForm" 
            name="contact"
            method="POST"
            data-netlify="true"
            netlify
            class="space-y-6 md:space-y-8"
          >
            <!-- Hidden Netlify Fields -->
            <input type="hidden" name="form-name" value="contact" />
            <input type="hidden" name="contact-method" id="contactMethodField" />
            
            <div class="text-center mb-8">
              <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
                Send a Message
              </h2>
              <p class="text-gray-600">
                Fill once. Choose how you want me to respond.
              </p>
            </div>

            <!-- Name -->
            <div>
              <label for="name" class="block text-lg font-medium text-gray-800 mb-2">
                Your Name *
              </label>
              <input 
                type="text" 
                id="name" 
                name="name" 
                required 
                class="w-full px-5 py-4 text-lg rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-3 focus:ring-blue-200 transition-all outline-none"
                placeholder="John Smith"
              />
            </div>

            <!-- Email -->
            <div>
              <label for="email" class="block text-lg font-medium text-gray-800 mb-2">
                Email Address *
              </label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                required 
                class="w-full px-5 py-4 text-lg rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-3 focus:ring-blue-200 transition-all outline-none"
                placeholder="john@example.com"
              />
            </div>

            <!-- Service -->
            <div>
              <label for="service" class="block text-lg font-medium text-gray-800 mb-2">
                Service Interest *
              </label>
              <select 
                id="service" 
                name="service" 
                required
                class="w-full px-5 py-4 text-lg rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-3 focus:ring-blue-200 transition-all outline-none"
              >
                <option value="">Select a service</option>
                <option value="Website Development">Website Development</option>
                <option value="AI Automation">AI Automation</option>
                <option value="Business Systems">Business Systems</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Project Details -->
            <div>
              <label for="message" class="block text-lg font-medium text-gray-800 mb-2">
                Project Details *
              </label>
              <textarea 
                id="message" 
                name="message" 
                rows="5"
                required
                class="w-full px-5 py-4 text-lg rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-3 focus:ring-blue-200 transition-all outline-none"
                placeholder="Tell me about your project, goals, budget, and timeline..."
              ></textarea>
            </div>

            <!-- Preferred Contact Method -->
            <div class="pt-4">
              <label class="block text-lg font-medium text-gray-800 mb-4">
                How should I contact you back? *
              </label>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- WhatsApp Option -->
                <div class="relative">
                  <input 
                    type="radio" 
                    id="whatsapp" 
                    name="contact-method-choice" 
                    value="whatsapp" 
                    class="hidden peer"
                    required
                  />
                  <label 
                    for="whatsapp" 
                    class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl cursor-pointer peer-checked:border-green-500 peer-checked:bg-green-50 hover:bg-gray-50 transition-all"
                  >
                    <div class="flex items-center gap-4">
                      <div class="h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center">
                        <span class="text-2xl">ðŸ’¬</span>
                      </div>
                      <div>
                        <div class="font-bold text-gray-900">WhatsApp</div>
                        <div class="text-gray-600 text-sm">Instant messaging</div>
                      </div>
                    </div>
                    <div class="h-6 w-6 rounded-full border-2 border-gray-300 peer-checked:bg-green-500 peer-checked:border-green-500"></div>
                  </label>
                </div>

                <!-- Email Option -->
                <div class="relative">
                  <input 
                    type="radio" 
                    id="emailMethod" 
                    name="contact-method-choice" 
                    value="email" 
                    class="hidden peer"
                    required
                  />
                  <label 
                    for="emailMethod" 
                    class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-xl cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:bg-gray-50 transition-all"
                  >
                    <div class="flex items-center gap-4">
                      <div class="h-12 w-12 rounded-xl bg-blue-100 flex items-center justify-center">
                        <span class="text-2xl">ðŸ“§</span>
                      </div>
                      <div>
                        <div class="font-bold text-gray-900">Email</div>
                        <div class="text-gray-600 text-sm">Formal communication</div>
                      </div>
                    </div>
                    <div class="h-6 w-6 rounded-full border-2 border-gray-300 peer-checked:bg-blue-500 peer-checked:border-blue-500"></div>
                  </label>
                </div>
              </div>
            </div>

            <!-- Submit Buttons (Dynamic) -->
            <div class="pt-6">
              <!-- WhatsApp Submit Button (Hidden by default) -->
              <button 
                type="button"
                id="whatsappSubmitBtn"
                class="hidden w-full px-8 py-5 bg-green-600 text-white font-bold text-xl rounded-xl hover:bg-green-700 hover:shadow-xl transition-all duration-300 mb-4"
              >
                ðŸ’¬ Send via WhatsApp
              </button>
              
              <!-- Email Submit Button (Hidden by default) -->
              <button 
                type="submit"
                id="emailSubmitBtn"
                class="hidden w-full px-8 py-5 bg-blue-600 text-white font-bold text-xl rounded-xl hover:bg-blue-700 hover:shadow-xl transition-all duration-300"
              >
                ðŸ“§ Send Message
              </button>
              
              <!-- Default Submit Button -->
              <button 
                type="button"
                id="defaultSubmitBtn"
                class="w-full px-8 py-5 bg-gray-300 text-gray-600 font-bold text-xl rounded-xl cursor-not-allowed"
                disabled
              >
                Select contact method above
              </button>
              
              <p class="text-gray-500 text-center mt-4">
                I'll respond within 24 hours.
              </p>
            </div>

            <!-- Message Display -->
            <div id="formMessage" class="hidden p-5 rounded-xl text-center text-lg"></div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <Footer />

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('contactForm');
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      const serviceInput = document.getElementById('service');
      const messageInput = document.getElementById('message');
      const contactMethodField = document.getElementById('contactMethodField');
      const whatsappRadio = document.getElementById('whatsapp');
      const emailRadio = document.getElementById('emailMethod');
      const whatsappBtn = document.getElementById('whatsappSubmitBtn');
      const emailBtn = document.getElementById('emailSubmitBtn');
      const defaultBtn = document.getElementById('defaultSubmitBtn');
      const formMessage = document.getElementById('formMessage');

      // Show appropriate submit button based on selection
      function updateSubmitButton() {
        if (whatsappRadio.checked) {
          whatsappBtn.classList.remove('hidden');
          emailBtn.classList.add('hidden');
          defaultBtn.classList.add('hidden');
          contactMethodField.value = 'whatsapp';
        } else if (emailRadio.checked) {
          emailBtn.classList.remove('hidden');
          whatsappBtn.classList.add('hidden');
          defaultBtn.classList.add('hidden');
          contactMethodField.value = 'email';
        } else {
          whatsappBtn.classList.add('hidden');
          emailBtn.classList.add('hidden');
          defaultBtn.classList.remove('hidden');
          contactMethodField.value = '';
        }
      }

      // Listen for contact method changes
      whatsappRadio.addEventListener('change', updateSubmitButton);
      emailRadio.addEventListener('change', updateSubmitButton);

      // WhatsApp Submission
      whatsappBtn.addEventListener('click', function() {
        // Get form data
        const name = nameInput.value.trim();
        const email = emailInput.value.trim();
        const service = serviceInput.value;
        const message = messageInput.value.trim();

        // Validate
        if (!name || !email || !service || !message) {
          showMessage('Please fill in all fields.', 'error');
          return;
        }

        // Create WhatsApp message
        const whatsappMessage = `Hi Anele!%0A%0AName: ${name}%0AEmail: ${email}%0AService: ${service}%0A%0AProject Details:%0A${message}%0A%0A(I contacted you via ThingsDoneImmediately.com)`;
        
        // Your WhatsApp number (formatted for WhatsApp link)
        const phoneNumber = '27763621131'; // +27 76 362 1131
        
        // Open WhatsApp
        window.open(`https://wa.me/${phoneNumber}?text=${whatsappMessage}`, '_blank');
        
        // Also submit to Netlify Forms (for your records)
        submitToNetlifyForms(name, email, service, message, 'whatsapp');
        
        // Show success message
        showMessage('âœ… WhatsApp opened! Please send the pre-filled message. I also saved your details.', 'success');
        
        // Clear form after a delay
        setTimeout(() => {
          form.reset();
          updateSubmitButton();
          showMessage('Form cleared. You can send another message.', 'info');
        }, 5000);
      });

      // Email Submission (Netlify Forms handles this)
      // The form will submit normally when emailBtn (type="submit") is clicked
      
      // Add loading state for email submission
      form.addEventListener('submit', function(e) {
        if (emailRadio.checked) {
          const emailBtn = document.getElementById('emailSubmitBtn');
          emailBtn.textContent = 'Sending...';
          emailBtn.disabled = true;
        }
      });

      // Form submission success (Netlify will redirect to thank you page)
      // We'll handle this with JavaScript for better UX
      async function submitToNetlifyForms(name, email, service, message, method) {
        try {
          const formData = new FormData();
          formData.append('form-name', 'contact');
          formData.append('name', name);
          formData.append('email', email);
          formData.append('service', service);
          formData.append('message', message);
          formData.append('contact-method', method);
          
          await fetch('/', {
            method: 'POST',
            body: formData,
          });
        } catch (error) {
          console.log('Netlify backup save:', error);
        }
      }

      // Helper function to show messages
      function showMessage(text, type) {
        formMessage.textContent = text;
        formMessage.className = 'p-5 rounded-xl text-center text-lg ';
        
        if (type === 'success') {
          formMessage.className += 'bg-green-100 text-green-700';
        } else if (type === 'error') {
          formMessage.className += 'bg-red-100 text-red-700';
        } else if (type === 'info') {
          formMessage.className += 'bg-blue-100 text-blue-700';
        }
        
        formMessage.classList.remove('hidden');
        formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      // Initialize
      updateSubmitButton();
    });
  </script>
</Main>